# ğŸ”¨ æ„å»ºè¯´æ˜

## æ„å»ºå‘½ä»¤

```bash
build-release.bat
```

---

## æ„å»ºè¿‡ç¨‹

### æ­¥éª¤ 1ï¼šæ¸…ç†å¹¶åˆ›å»º release ç›®å½•

åˆ é™¤æ—§çš„ release ç›®å½•ï¼Œåˆ›å»ºæ–°çš„ç›®å½•ç»“æ„ã€‚

### æ­¥éª¤ 2ï¼šæ„å»ºå‰ç«¯

```bash
cd frontend
npm install
npm run build
```

ç”Ÿæˆ `frontend/dist/` ç›®å½•ã€‚

### æ­¥éª¤ 3ï¼šå¤åˆ¶å‰ç«¯æ–‡ä»¶

å°† `frontend/dist/` å¤åˆ¶åˆ° `release/backend/dist/`ã€‚

### æ­¥éª¤ 4ï¼šæ··æ·†åç«¯ä»£ç 

ä½¿ç”¨ `javascript-obfuscator` æ··æ·†ä»¥ä¸‹æ–‡ä»¶ï¼š
- `backend/app.js`
- `backend/routes/*.js`
- `backend/utils/*.js`

æ··æ·†åçš„ä»£ç å¤åˆ¶åˆ° `release/backend/`ã€‚

### æ­¥éª¤ 5ï¼šåˆ›å»ºå¹²å‡€çš„é…ç½®æ–‡ä»¶

#### users.jsonï¼ˆåªåŒ…å« adminï¼‰

```json
{
  "admin": {
    "username": "admin",
    "password": "$2a$10$...",
    "role": "super_admin",
    "createdAt": "2024-01-01T00:00:00.000Z"
  }
}
```

#### repo-config.jsonï¼ˆç©ºé…ç½®ï¼‰

```json
{
  "repos": {}
}
```

#### åˆ›å»ºç©ºç›®å½•

- `release/backend/repos/` - Git ä»“åº“å­˜å‚¨ç›®å½•
- `release/backend/logs/` - æ—¥å¿—ç›®å½•

### æ­¥éª¤ 6ï¼šåˆ›å»ºå¯åŠ¨è„šæœ¬å’Œæ–‡æ¡£

- `release/start.bat` - Windows å¯åŠ¨è„šæœ¬
- `release/README.md` - éƒ¨ç½²è¯´æ˜

---

## æ„å»ºè¾“å‡º

```
release/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.js                    # æ··æ·†åçš„ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ routes/                   # æ··æ·†åçš„è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth-routes.js
â”‚   â”‚   â”œâ”€â”€ git-http.js
â”‚   â”‚   â”œâ”€â”€ operation-log-routes.js
â”‚   â”‚   â”œâ”€â”€ repo-management-routes.js
â”‚   â”‚   â”œâ”€â”€ repo-routes.js
â”‚   â”‚   â””â”€â”€ user-management-routes.js
â”‚   â”œâ”€â”€ utils/                    # æ··æ·†åçš„å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth-utils.js
â”‚   â”‚   â”œâ”€â”€ config-manager.js
â”‚   â”‚   â”œâ”€â”€ git-logger.js
â”‚   â”‚   â”œâ”€â”€ git-utils.js
â”‚   â”‚   â”œâ”€â”€ operation-logger.js
â”‚   â”‚   â””â”€â”€ repo-permission.js
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ users.json           # ç”¨æˆ·é…ç½®ï¼ˆåªæœ‰ adminï¼‰
â”‚   â”‚   â””â”€â”€ repo-config.json     # ä»“åº“é…ç½®ï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ repos/                    # Git ä»“åº“ç›®å½•ï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ logs/                     # æ—¥å¿—ç›®å½•ï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ dist/                     # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ package.json              # ä¾èµ–é…ç½®
â”œâ”€â”€ config.json                   # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ README.md                     # éƒ¨ç½²è¯´æ˜
â””â”€â”€ start.bat                     # å¯åŠ¨è„šæœ¬
```

---

## æ„å»ºç‰¹ç‚¹

### âœ… ä»£ç æ··æ·†

- ä½¿ç”¨ `javascript-obfuscator` æ··æ·†åç«¯ä»£ç 
- ä¿æŠ¤æºä»£ç ä¸è¢«è½»æ˜“é˜…è¯»
- æ··æ·†é€‰é¡¹ï¼š
  - æ§åˆ¶æµæ‰å¹³åŒ–
  - æ­»ä»£ç æ³¨å…¥
  - å­—ç¬¦ä¸²æ•°ç»„åŠ å¯†
  - æ ‡è¯†ç¬¦é‡å‘½å

### âœ… å¹²å‡€çš„é…ç½®

- åªä¿ç•™é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼ˆadmin/123456ï¼‰
- æ¸…ç©ºæ‰€æœ‰ä»“åº“æ•°æ®
- æ¸…ç©ºæ‰€æœ‰æ—¥å¿—
- æ¸…ç©ºæƒé™é…ç½®

### âœ… æœ€å°åŒ–ä¾èµ–

- `package.json` åªåŒ…å« `dependencies`
- ä¸åŒ…å« `devDependencies`
- ç”¨æˆ·éœ€è¦è‡ªå·±è¿è¡Œ `npm install`

---

## æ„å»ºåçš„æ“ä½œ

### 1. éªŒè¯æ„å»º

```bash
# æ£€æŸ¥ç›®å½•ç»“æ„
dir release /s

# æ£€æŸ¥é…ç½®æ–‡ä»¶
type release\backend\config\users.json
type release\backend\config\repo-config.json
```

### 2. æµ‹è¯•è¿è¡Œ

```bash
cd release\backend
npm install
cd ..
start.bat
```

### 3. æ‰“åŒ…åˆ†å‘

```bash
# å‹ç¼©ä¸º zip
tar -a -c -f release.zip release

# æˆ–ä½¿ç”¨ 7-Zip
7z a release.zip release
```

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ å¯†ç å®‰å…¨

æ„å»ºçš„å‘å¸ƒåŒ…åŒ…å«é»˜è®¤å¯†ç  `123456`ï¼Œéƒ¨ç½²åè¯·ç«‹å³ä¿®æ”¹ï¼š

1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥"ç”¨æˆ·ç®¡ç†"
3. ä¿®æ”¹ admin å¯†ç 

### âš ï¸ é…ç½®æ–‡ä»¶

æ„å»ºæ—¶ä¼šå¤åˆ¶æ ¹ç›®å½•çš„ `config.json`ï¼Œç¡®ä¿é…ç½®æ­£ç¡®ï¼š

```json
{
  "server": {
    "host": "localhost",
    "port": 9001
  }
}
```

éƒ¨ç½²æ—¶éœ€è¦ä¿®æ”¹ä¸ºå®é™…çš„æœåŠ¡å™¨åœ°å€ã€‚

### âš ï¸ ä¾èµ–å®‰è£…

å‘å¸ƒåŒ…ä¸åŒ…å« `node_modules`ï¼Œç”¨æˆ·éœ€è¦è‡ªå·±å®‰è£…ï¼š

```bash
cd release/backend
npm install
```

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šæ„å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼š`npm run build` å¤±è´¥

**è§£å†³**ï¼š
```bash
cd frontend
npm install
npm run build
```

### é—®é¢˜ 2ï¼šæ··æ·†å¤±è´¥

**ç—‡çŠ¶**ï¼š`javascript-obfuscator` æŠ¥é”™

**è§£å†³**ï¼š
```bash
npm install javascript-obfuscator
```

### é—®é¢˜ 3ï¼šrelease ç›®å½•ä¸ºç©º

**ç—‡çŠ¶**ï¼šæ„å»ºå®Œæˆä½† release ç›®å½•ä¸ºç©º

**è§£å†³**ï¼š
1. æ£€æŸ¥æ„å»ºæ—¥å¿—
2. ç¡®è®¤ `frontend/dist` å­˜åœ¨
3. é‡æ–°è¿è¡Œ `build-release.bat`

---

## è‡ªå®šä¹‰æ„å»º

### ä¿®æ”¹æ··æ·†é€‰é¡¹

ç¼–è¾‘ `build-release.js`ï¼Œä¿®æ”¹ `obfuscationOptions`ï¼š

```javascript
const obfuscationOptions = {
	compact: true,
	controlFlowFlattening: true,
	// ... å…¶ä»–é€‰é¡¹
}
```

### ä¿ç•™å¼€å‘æ•°æ®

å¦‚æœä¸æƒ³æ¸…ç†æ•°æ®ï¼Œä¿®æ”¹ `copyConfigFiles()` å‡½æ•°ï¼š

```javascript
// å¤åˆ¶ç°æœ‰é…ç½®è€Œä¸æ˜¯åˆ›å»ºæ–°çš„
fs.copySync(
	path.join(BACKEND_DIR, "config"),
	path.join(backendRelease, "config")
)
```

---

## æ€»ç»“

âœ… **ä¸€é”®æ„å»º**ï¼šè¿è¡Œ `build-release.bat`  
âœ… **ä»£ç æ··æ·†**ï¼šä¿æŠ¤æºä»£ç   
âœ… **å¹²å‡€é…ç½®**ï¼šé€‚åˆåˆ†å‘  
âœ… **æœ€å°åŒ–**ï¼šåªåŒ…å«å¿…è¦æ–‡ä»¶  

**æ„å»ºå®Œæˆåå³å¯åˆ†å‘ç»™å…¶ä»–äººä½¿ç”¨ï¼** ğŸ‰
