# 🚀 部署检查清单

## 部署前检查

### 环境要求

- [ ] Node.js 已安装（建议 v16+）
- [ ] npm 已安装
- [ ] Git 已安装并可用
- [ ] 端口 3000 和 5173 未被占用

### 代码检查

- [x] 后端代码语法检查通过
- [x] 前端代码结构正确
- [x] 所有依赖已安装
- [x] 配置文件正确

## 部署步骤

### 1. 后端部署

```bash
cd backend

# 检查依赖
npm list

# 如果缺少依赖，安装
npm install

# 启动服务
npm start
```

**预期输出**：
```
Server running on http://localhost:3000
```

### 2. 前端部署

```bash
cd frontend

# 检查依赖
npm list highlight.js

# 如果缺少依赖，安装
npm install

# 启动开发服务器
npm run dev
```

**预期输出**：
```
VITE ready in xxx ms
Local: http://localhost:5173/
```

### 3. 验证部署

#### 后端验证

```bash
# 测试后端健康检查
curl http://localhost:3000/api/repo/config
```

**预期响应**：
```json
{
  "code": 200,
  "data": {
    "serverUrl": "...",
    "serverIP": "...",
    "serverPort": 3000
  }
}
```

#### 前端验证

1. 打开浏览器访问：http://localhost:5173
2. 应该看到登录页面
3. 登录后应该看到仓库列表

## 功能测试

### 基础功能测试

#### 1. 登录测试
- [ ] 可以访问登录页
- [ ] 可以成功登录
- [ ] 登录后跳转到首页

#### 2. 仓库列表测试
- [ ] 可以看到仓库列表
- [ ] 可以搜索仓库
- [ ] 可以点击进入仓库详情

#### 3. 文件浏览测试
- [ ] 可以看到"文件"选项卡
- [ ] 可以加载文件树
- [ ] 可以展开文件夹
- [ ] 可以点击文件查看内容
- [ ] 代码有语法高亮
- [ ] 可以搜索文件名
- [ ] 可以切换分支
- [ ] 可以复制代码
- [ ] 可以下载文件

#### 4. 提交历史测试
- [ ] 可以看到"提交历史"选项卡
- [ ] 可以加载提交列表
- [ ] 可以看到分支图
- [ ] 可以看到提交信息
- [ ] 可以切换分支
- [ ] 可以加载更多提交

#### 5. 权限管理测试
- [ ] 可以进入权限管理页面
- [ ] 可以看到仓库列表
- [ ] 可以看到访问权限状态
- [ ] 可以看到代码查看权限状态
- [ ] 可以设置访问权限
- [ ] 可以设置代码查看权限
- [ ] 权限设置立即生效

### 权限测试

#### 超级管理员测试
- [ ] 可以查看所有仓库
- [ ] 可以查看所有代码
- [ ] 可以设置所有权限

#### 管理员测试
- [ ] 可以查看有权限的仓库
- [ ] 默认可以查看代码
- [ ] 可以设置权限

#### 普通用户测试
- [ ] 可以查看有权限的仓库
- [ ] 默认无法查看代码
- [ ] 授权后可以查看代码
- [ ] 无权限时显示友好提示

### 边界测试

#### 文件浏览边界测试
- [ ] 空仓库处理正确
- [ ] 大文件（>5MB）提示正确
- [ ] 二进制文件提示正确
- [ ] 图片预览正常
- [ ] 深层目录加载正常
- [ ] 特殊字符文件名处理正常

#### 提交历史边界测试
- [ ] 无提交时提示正确
- [ ] 单个提交显示正常
- [ ] 大量提交分页正常
- [ ] 分支切换正常

#### 权限边界测试
- [ ] 无权限时提示正确
- [ ] 权限配置为空时使用默认规则
- [ ] 权限继承正确
- [ ] 自定义权限正确

## 性能测试

### 文件浏览性能
- [ ] 大量文件（>100个）加载速度可接受
- [ ] 文件树懒加载正常
- [ ] 文件内容加载速度可接受

### 提交历史性能
- [ ] 大量提交（>100个）加载速度可接受
- [ ] 分页加载正常
- [ ] 滚动流畅

### 权限检查性能
- [ ] 权限检查不影响响应速度
- [ ] 多次请求性能稳定

## 浏览器兼容性测试

- [ ] Chrome/Edge（推荐）
- [ ] Firefox
- [ ] Safari
- [ ] 移动端浏览器

## 安全测试

### 认证测试
- [ ] 未登录无法访问 API
- [ ] Token 过期后自动跳转登录
- [ ] 登出后无法访问

### 权限测试
- [ ] 普通用户无法访问管理功能
- [ ] 权限验证正确
- [ ] 403 错误提示友好

### 数据安全测试
- [ ] 敏感信息不泄露
- [ ] 错误信息不暴露系统细节
- [ ] 操作日志记录正确

## 日志检查

### 后端日志
- [ ] 操作日志记录正确
- [ ] 错误日志记录正确
- [ ] 日志文件可访问

### 前端日志
- [ ] 浏览器控制台无错误
- [ ] 网络请求正常
- [ ] 资源加载正常

## 配置检查

### 后端配置
- [ ] `backend/config/repo-config.json` 存在
- [ ] `backend/config/users.json` 存在
- [ ] `backend/config/.env` 配置正确

### 前端配置
- [ ] `frontend/.env.development` 配置正确
- [ ] `frontend/.env.production` 配置正确

## 文档检查

- [x] FEATURE-CODE-VIEWER.md - 功能文档
- [x] PERMISSION-FEATURE.md - 权限文档
- [x] QUICK-START.md - 快速启动
- [x] test-api.md - API 测试
- [x] IMPLEMENTATION-SUMMARY.md - 实现总结
- [x] CHECKLIST.md - 检查清单
- [x] CODE-VIEWER-README.md - 总览文档
- [x] FINAL-SUMMARY.md - 最终总结
- [x] DEPLOYMENT-CHECKLIST.md - 部署清单（本文件）

## 故障排除

### 常见问题

#### 1. 后端启动失败
**检查**：
- [ ] 端口 3000 是否被占用
- [ ] Node.js 版本是否正确
- [ ] 依赖是否安装完整

**解决**：
```bash
# 检查端口
netstat -ano | findstr :3000

# 重新安装依赖
cd backend
rm -rf node_modules
npm install
```

#### 2. 前端启动失败
**检查**：
- [ ] 端口 5173 是否被占用
- [ ] Node.js 版本是否正确
- [ ] 依赖是否安装完整

**解决**：
```bash
# 检查端口
netstat -ano | findstr :5173

# 重新安装依赖
cd frontend
rm -rf node_modules
npm install
```

#### 3. 文件树为空
**检查**：
- [ ] 仓库是否有提交
- [ ] Git 是否已安装
- [ ] 仓库路径是否正确

**解决**：
```bash
# 检查 Git
git --version

# 检查仓库
cd repos/test
git log
```

#### 4. 代码没有高亮
**检查**：
- [ ] highlight.js 是否安装
- [ ] 浏览器控制台是否有错误

**解决**：
```bash
# 检查依赖
cd frontend
npm list highlight.js

# 重新安装
npm install highlight.js
```

#### 5. 权限不生效
**检查**：
- [ ] 用户是否重新登录
- [ ] 配置文件是否正确
- [ ] 后端日志是否有错误

**解决**：
- 刷新页面
- 重新登录
- 检查 `backend/config/repo-config.json`

## 生产环境部署

### 前端构建

```bash
cd frontend
npm run build
```

**输出目录**：`frontend/dist/`

### 部署到生产服务器

1. 将 `frontend/dist/` 部署到 Web 服务器（如 Nginx）
2. 配置反向代理到后端 API
3. 配置 HTTPS（推荐）
4. 配置域名

### Nginx 配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # 前端静态文件
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端 API 代理
    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Git HTTP 代理
    location /git {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 监控和维护

### 日志监控
- [ ] 定期检查操作日志
- [ ] 定期检查错误日志
- [ ] 设置日志轮转

### 性能监控
- [ ] 监控 API 响应时间
- [ ] 监控内存使用
- [ ] 监控磁盘空间

### 备份
- [ ] 定期备份配置文件
- [ ] 定期备份仓库数据
- [ ] 定期备份用户数据

## 完成确认

### 部署完成
- [ ] 后端服务正常运行
- [ ] 前端服务正常运行
- [ ] 所有功能测试通过
- [ ] 所有权限测试通过
- [ ] 所有边界测试通过
- [ ] 浏览器兼容性测试通过
- [ ] 安全测试通过
- [ ] 性能测试通过

### 文档完成
- [ ] 所有文档已创建
- [ ] 所有文档已审核
- [ ] 用户手册已提供

### 培训完成
- [ ] 管理员培训完成
- [ ] 用户培训完成
- [ ] 技术支持准备就绪

## 🎉 部署成功！

**恭喜！** 所有功能已成功部署并可以使用！

---

**部署日期**: ___________  
**部署人员**: ___________  
**验收人员**: ___________  
**签字确认**: ___________
