# NPM权限管理指南

## 功能概述

NPM权限管理系统提供了精细化的包发布权限控制，支持三种权限级别：
- **登录权限**：是否允许用户使用 `npm login` 登录到私有仓库
- **发布权限**：是否允许用户发布NPM包
- **管理权限**：是否允许用户删除、废弃NPM包

## 包权限配置

### 权限模式

1. **不允许发布任何包**
   - 用户无法发布任何包
   - 适用于只需要下载包的用户

2. **允许发布所有包**
   - 用户可以发布任意名称的包
   - 适用于管理员和超级管理员

3. **自定义包列表**
   - 精确控制用户可以发布的包名
   - 支持两种添加方式：
     - **从现有包中选择**：从已发布的包列表中勾选
     - **手动添加包名**：输入新的包名（支持尚未发布的包）

### 使用场景

#### 场景1：团队协作
```
用户A：只能发布 @company/ui-* 相关的包
用户B：只能发布 @company/utils-* 相关的包
管理员：可以发布所有包
```

#### 场景2：项目隔离
```
前端团队：只能发布前端相关包
后端团队：只能发布后端相关包
DevOps团队：可以发布所有包
```

## 操作步骤

### 1. 访问权限管理页面
- 登录系统后，点击"权限管理"
- 切换到"NPM权限"标签页

### 2. 编辑用户权限
- 点击用户行的"编辑权限"按钮
- 配置登录、发布、管理权限
- 选择包权限模式

### 3. 配置自定义包列表
如果选择"自定义包列表"：

#### 从现有包中选择
- 在"从现有包中选择"区域勾选需要的包
- 支持多选，实时显示已选择的包

#### 手动添加包名
- 在"手动添加包名"输入框中输入包名
- 支持添加尚未发布的包名
- 点击"添加"按钮或按回车键添加

#### 管理已选择的包
- 在"已选择的包"区域查看所有已选择的包
- 点击包名标签的"×"按钮可以删除

### 4. 保存设置
- 点击"保存"按钮应用权限设置
- 系统会自动同步到NPM认证系统

## 权限验证

### 发布时的权限检查
当用户执行 `npm publish` 时，系统会：
1. 验证用户身份（npm login状态）
2. 检查用户是否有发布权限
3. 验证包名是否在允许列表中
4. 记录发布操作日志

### 权限拒绝处理
如果权限不足，用户会收到明确的错误提示：
- `您没有访问NPM仓库的权限，请联系管理员`
- `您没有发布包 "package-name" 的权限`

## 最佳实践

### 1. 权限分层
- **超级管理员**：所有权限
- **项目管理员**：项目相关包的发布权限
- **开发者**：特定模块的发布权限
- **只读用户**：仅登录权限

### 2. 包命名规范
建议使用命名空间来组织包：
```
@company/ui-button
@company/ui-table
@company/utils-http
@company/utils-date
```

### 3. 权限审计
- 定期检查用户权限设置
- 及时回收离职员工的权限
- 监控包发布日志

## 故障排除

### 常见问题

1. **无法登录NPM**
   - 检查用户是否有登录权限
   - 确认用户名密码正确

2. **发布被拒绝**
   - 检查用户是否有发布权限
   - 确认包名在允许列表中

3. **包列表为空**
   - 确认Verdaccio服务正常运行
   - 检查是否有已发布的包

### 技术支持
如遇到问题，请联系系统管理员或查看操作日志获取详细信息。
